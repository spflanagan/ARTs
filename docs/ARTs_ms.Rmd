---
title: "Genetic architecthure of alternative reproductive tactics"
author:
- affilnum: 1
  corresponding: yes
  email: spflanagan.phd@gmail.com
  name: Sarah P. Flanagan
- affilnum: 2
  name: Suzanne Alonzo
output:
  bookdown::pdf_document2:
    fig_caption: yes
    keep_tex: yes
    number_sections: no
    template: manuscript.latex
    toc: yes
    toc_depth: 2
  html_document: null
  pdf_document:
    toc: yes
    toc_depth: '2'
  word_document: null
zotero: "My Library"
capsize: normalsize
csl: https://github.com/citation-style-language/styles/blob/master/proceedings-of-the-royal-society-b.csl
documentclass: article
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: 72
fontsize: 11pt
abstract: |
header-includes: |
  \usepackage{lipsum} \usepackage{float} \floatplacement{figure}{H}
affiliation:
- affil: School of Biological Sciences, University of Canterbury, 4800 Private Bag,
    Christchurch 8140 New Zealand
  affilnum: 1
- affil: University of California Santa Cruz, Santa Cruz, California, USA
  affilnum: 2
preprint: no
spacing: singlespacing
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,out.extra='',fig.pos="H",
                      warning=FALSE,message=FALSE)
knitr::opts_knit$set(root.dir='../fwsw_results/')
```

# Introduction

Maintenance of variation in populations.

Alternative reproductive tactics as stable polymorphisms,

-   often maintained through frequency-dependent selection

-   possibly resolves sexual conflict

-   Genetic basis of alternative reproductive tactics shows that there
    is some propensity for these to be grouped together into supergenes.

-   white-collared sparrow

-   ruffs [@kupper2016][@lamichhaney2016]

-   side-blotched lizards (maybe)

-   \- ??

But, we don't know which came first, and to what extent genetic
architecture determines the evolution of alternative reproductive
tactics. Therefore, we used simulation models to understand this.

# Methods

Our model focusses on a single population of diploid males and females
with non-overlapping generations. We model two independent traits,
courtship and parental care, both of which are expressed only in males,
but are also inherited by females. As such, males are one of four
morphs: courter/parents; courter/non-parents; non-courters/parents; or
non-courters/non-parents. The model is inspired by fish species like the
ocellated wrasse, *Symphodus ocellatus*, and as such we will use
terminology appropriate to that species. Nonetheless, our model can be
generalized to any species in which one sex (but not the other) has two
traits that impact mating success and the survival of their offspring.

Each generation has three distinct phases: (1) mate choice and
fertilization; (2) parental care; and (3) viability selection. In the
mate choice phase of the model, females always prefer to mate with males
displaying the courtship trait. If a female decides to mate with a male,
he receives all of her eggs to care for. The male is not guaranteed
paternity of his mates' entire brood, however, because non-courting
males are able to fertilize a proportion of the eggs. The chosen parent
does receive first-male priority. The consequences of this setup are
that the only mechanism by which non-courters can produce offspring is
through these sneak fertilizations. In the parental care phase of the
model, males with the parental care trait have 100% nest survival while
males without the parental care trait have 0% nest survival, independent
of the male's courtship trait. Consequently, non-parents will only be
sustained in the population by sneaking fertilizations in the parental
males' nests. Finally, viability selection is imposed on offspring as
they mature to adulthood, such that males carrying the courtship trait
and/or the parental care trait have a lower probability of survival than
females and males without either courtship or parenting. Males who are
both courters and parents have a multiplicative effect of viability
selection. **Who is allowed to sneak?**

We implemented our model first as a mathematical model and then as an
individual-based simulation model. The purpose of the mathematical model
was to generate baseline predictions for when multiple morphs are
maintained.

## Frequency-dependent population dynamics model

In the mathematical model, we model the proportion of the population
that belong to morphs at each stage of the lifecycle (Fig.
\@ref(fig:mathModel)). In the first stage, we consider the proportion of
the population's nests that will be allocated to each morph. The maximum
number of nests that could be laid is proportional to the number of
males in the population ($N_m$), if each male has the same likelihood of
attracting a female to deposit eggs with him. However, in our model,
males are not equally likely to be chosen by females, and therefore the
maximum number of nests is scaled by the probability of females mating
with each type of male morph. In the case of our model, the total number
of nests laid in the population becomes $$
\frac{N_f}{N_mf_{CP}+N_m f_{CNp}}
$$ because we have constrained females to only mate with courting males.

```{r mathModel, fig.cap="Diagram of the mathematical model describing the inheritance of alternative male reproductive morphs given courtship and parenting traits."}
knitr::include_graphics("../figs/frequency_dependence.png")
```

Likewise, the proportion of nests each type of male receives (${p_n}_M$)
is determined by the number of morphs in the population ($N_mf_M$ for
the $M$ morph), the probability of a female choosing that morph
(${w_s}_M$), and the ratio of the number of nests to the number of
females ($n/N_f$).

Within a given nest, the offspring could either be fertilized by the
nest-holding male or non-courting males 'sneaking' fertilizations.
Therefore, each morph has a proportion of eggs fertilized within their
own nests (${p_{fn}}_M$) and a proportion of eggs fertilized in other
males' nests (${p_{fs}}_M$). These proportions were determined by the
sperm competition coefficient, $c$, which penalized non-courting males,
and the relative reproductive investment for that morph ($r_M$).
Analogously, the proportion of offspring in a nest surviving due to
parental care investment can be split into the proportion surviving in a
male's own nest (${p_{sn}}_M$) or in another male's nest (${p_{ss}}_M$),
which is simply the proportions from the fertilization step weighted by
the probability of the nest surviving if the morph is a parent ($w_n=1$)
or of the morph is a non-parent ($w_n=0$). These proportions
(${p_{sn}}_M$ and ${p_{ss}}_M$) are summed to determine the the overall
proportion of embryos in the population that survive the parenting phase
in each morph's nests (${p_s}_M$).

The final stage of the lifecycle is for offspring surviving in the nest
to undergo viability selection by multiplying the viability selection
coefficient (${w_v}_M$) by the surviving proportion (${p_s}_M$) and the
original frequency of the morph in the population (**Note: does pv need
the frequency multiplication??)**. Finally, the frequency of each morph
in the next generation was calculated by dividing the surviving
proportion (${p_v}_M$ by the sum of all proportions.

To evaluate the outcomes of this mathematical model, we iterated forward
in time for 100 generations from XX combinations of initial morph
frequencies and repeated those iterations across XX values for the sperm
competition coefficient ($c$ = {0..1}) and XX values for the relative
reproductive coefficient ($r_M$ = {0...1}). The iterations were
implemented in R v. 4.1.1 [@rcoreteam2021] using some features of tidyR
[@wickham2021]. To facilitate visualisation of the results, we
calculated the Shannon's diversity index for the morphs remaining in the
100th generation using the R package vegan [@oksanen2015]. We then
visualised the diversity of the population using contour plots produced
by plotly [@sievert2020] in a shiny app that relies on R packages shiny
[@chang2021], shinydashboard [@chang2018], rsconnect [@mcpherson2021],
dplyr [@wickham2021], and rmarkdown [@allaire2021; @xie2020; @xie2018].
The interactive app is available at
<https://spflanagan.shinyapps.io/morph_predictions/>.

**this model has no recombination/females do not pass on a morph**

## Individual-based simulation model

To evaluate the role of genetic architecture in the maintenance of
alternative reproductive tactics, we wrote an individual-based
simulation model in C++. The simulation model follows the same lifecycle
as described above, but rather than tracking proportions of the
population belonging to particular morphs, we tracked individuals within
the population. Each individual contained diploid genotypes, which
included both non-coding loci and quantitative trait loci (QTLs). We
included two types of QTLs: ones that impacted the individual's courting
trait and ones that impacted the individual's parenting trait. The QTLs
were each assigned a randomly-drawn effect on the trait, and the QTLs
additively determined the trait value for each trait (i.e., the effects
of all QTLs were summed to determine the trait value). In this model, we
assume no environmental effects impacted the trait value. These trait
values were then compared to a threshold to dichotomize each trait. The
threshold for each trait was the mean trait value during the
initialization of the model (i.e., at generation 0). *QTLs could impact
either the courtship trait, the parenting trait, or both -- check this
statement for veracity.*

Other important components of the individuals:

-   female preferences

-   sex

-   reproductive allocation ($pot_rs$).

-   mutation functions

-   assign_court_morph -- when is this used? It has ind_cthresh, which
    is in individuals::determine_thresholds() -- this is called in
    populations::set_thresholds()

We implemented three different genetic architectures: a single gene per
trait, multiple QTLs randomly placed throughout chromosomes, and
supergenes. The single gene scenario is most analogous to the
mathematical model described above. When the traits have multiple QTLs
determining their trait values, each QTL is assigned a location on a
chromosome and the QTL's effect on the trait is associated with a single
nucleotide polymorphism (SNP). These SNPs undergo recombination and
mutation during mating. The supergene scenario forced the QTLs to
cluster into a small proportion of one of the chromosomes. These QTLs
still experience mutation but experienced reduced recombination.

The lifecycle:

When we ran the model, we initialized four replicate populations with
the identical starting conditions to evaluate the impact of
stochasticity on the model. These identical conditions included
randomly-generated values for the allelic effects of QTLs, exact number
of individuals of each sex and morph, and thresholds for determining
morph traits (i.e., the values at which an individual is deemed a
courter vs a non-courter and a parent vs a non-parent). For each set of
four populations, we ran 10,000 burn-in generations followed by 2,000
'experimental' generations. Doing so ensured that the population reached
a steady state in which we could examine any stable polymorphisms or
cyclical fluctuations in morph frequencies.

Within each of those generations, the population underwent four main
phases: (1) mate choice and fertilization; (2) nest survival; (3)
viability selection on juveniles; (4) maturation to adulthood. The main
difference between the individual-based simulation model and the
mathematical model were the introduction of stochasticity during mate
choice and the introduction of recombination and mutation during
reproduction. During the mate choice phase, females searched through a
set number of males and chose the first attractive male (i.e., the first
courter male she encountered). If a female did not find an acceptable
mate, she chose a male at random with from the population and allocated
all of her offspring to him.

Once a female chose a male, fertilization of the eggs occurred, in which
the chosen male had first male priority (i.e., the chosen male allocated
all of his reproductive effort to his own nest) and up to 3 non-courting
males could 'sneak' fertilizations, with their contributions discounted
by a factor of $c$. After the males were assigned their paternity
shares, the nests survived if the chosen male was also a parent.
Subsequently, the total number of offspring in the population were
created based on the proportion of population reproductive success
achieved by each individual male and female (i.e., each generation, the
number of offspring created was equal to the carrying capacity).

When fertilization occurred, the parents' genotypes (both neutral
markers and QTLs) had the opportunity to recombine. Recombination
occurred independently on the chromosome inherited from the mother and
the chromosome inherited from the father. The number of recombination
events for a given chromosome was determined by drawing from a Poisson
distribution with the recombination rate as the mean, which we set to
0.2. For each recombination event, breakpoints were chosen by randomly
drawing from the total number of markers on a chromosome. These
breakpoints defined the segments of the chromosome that experienced
recombination, and each segment was randomly chosen to be assigned the
genotypes and effects from the parents' maternal or paternal chromosome.
When the genetic architecture was that of a supergene, if the
breakpoints fell within the region containing the aggregated QTLs for
the traits, the offspring was considered not viable.

After recombination occurred, if the progeny survived, the genotypes
underwent mutation, which occurred at a rate of $mu$. For a given
individual, the number of mutations introduced was determined as
$2\mu*n_SNPs*n_chrom$. The location of each mutation was randomly
selected and the allele at that location was randomly chosen from the
set of existing alleles. The mutation also impacted the phenotypic
effects of QTLs by altering the original effect by a value drawn from a
normal distribution with a mean of 0 and a standard deviation of
$sigma_\mu$. Finally, offspring were also randomly assigned a sex.

The next stage in the lifecycle was viability selection, which impacted
only male offspring. For each male offspring, a survival probability was
calculated as $e^{\frac{-morph2}{2\omega_v}}$. Viability selection acted
multiplicatively on courter-parents (their survival probability was
$e^{\frac{-morph2}{2\omega_v}}*e^{\frac{-morph2}{2\omega_v}}$). A random
value between 0 and 1 was drawn, and if the number was larger than the
survival probability for an individual, that individual did not survive
to adulthood. If, at this point, the number of surviving offpsring was
larger than the carrying capacity, offspring were randomly selected to
become adults. When offspring matured to adulthood, the previous
generation's adults were replaced, and the lifecycle began again.

# Results

## Frequency-dependent population dynamics model

## Individual-based simulation model

# Discussion

# Acknowledgments

We acknowledge Ngāi Tūāhuriri, upon whose lands the analyses and writing
was conducted. This work was conducted in part while SPF was a
postdoctoral fellowship at the National Institute for Mathematical and
Biological Synthesis, sponsored by the National Science Foundation
through NSF Award \#DBI-1300426, with additional support from The
University of Tennessee, Knoxville.

# Data Accessibility

All code has been archived on Zenodo (DOI: ) and is maintained on github
(). Simulation results are archived on dryad ().

# Author Contributions

# References
